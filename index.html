<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game with PyScript</title>
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
    }
    canvas {
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <py-script>
    from js import document, window
    import random

    canvas = document.getElementById("gameCanvas")
    ctx = canvas.getContext("2d")

    grid_size = 20
    tile_count = canvas.width // grid_size

    snake = [{"x": 10, "y": 10}]
    food = {"x": 5, "y": 5}
    direction = {"x": 0, "y": 0}
    score = 0

    def draw():
        ctx.fillStyle = "#1a1a1a"
        ctx.fillRect(0, 0, canvas.width, canvas.height)

        ctx.fillStyle = "lime"
        for segment in snake:
            ctx.fillRect(segment["x"] * grid_size, segment["y"] * grid_size, grid_size, grid_size)

        ctx.fillStyle = "red"
        ctx.fillRect(food["x"] * grid_size, food["y"] * grid_size, grid_size, grid_size)

        ctx.fillStyle = "white"
        ctx.font = "20px Arial"
        ctx.fillText(f"Score: {score}", 10, 30)

    def update():
        global score

        head = {"x": snake[0]["x"] + direction["x"], "y": snake[0]["y"] + direction["y"]}

        if head["x"] < 0:
            head["x"] = tile_count - 1
        if head["x"] >= tile_count:
            head["x"] = 0
        if head["y"] < 0:
            head["y"] = tile_count - 1
        if head["y"] >= tile_count:
            head["y"] = 0

        for segment in snake:
            if segment["x"] == head["x"] and segment["y"] == head["y"]:
                reset_game()
                return

        snake.insert(0, head)

        if head["x"] == food["x"] and head["y"] == food["y"]:
            score += 1
            place_food()
        else:
            snake.pop()

    def place_food():
        food["x"] = random.randint(0, tile_count - 1)
        food["y"] = random.randint(0, tile_count - 1)

        for segment in snake:
            if segment["x"] == food["x"] and segment["y"] == food["y"]:
                place_food()
                break

    def reset_game():
        global snake, direction, score
        snake = [{"x": 10, "y": 10}]
        direction = {"x": 0, "y": 0}
        score = 0
        place_food()

    def on_keydown(event):
        if event.key == "ArrowUp" and direction["y"] == 0:
            direction["x"] = 0
            direction["y"] = -1
        elif event.key == "ArrowDown" and direction["y"] == 0:
            direction["x"] = 0
            direction["y"] = 1
        elif event.key == "ArrowLeft" and direction["x"] == 0:
            direction["x"] = -1
            direction["y"] = 0
        elif event.key == "ArrowRight" and direction["x"] == 0:
            direction["x"] = 1
            direction["y"] = 0

    window.addEventListener("keydown", on_keydown)

    def game_loop():
        update()
        draw()
        window.requestAnimationFrame(game_loop)

    place_food()
    game_loop()
  </py-script>
</body>
</html>
